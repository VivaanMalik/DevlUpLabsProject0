name: Run on unsoobscribe

on:
  repository_dispatch:
    types: [unsubscribed]

jobs:
  run-script:
      runs-on: ubuntu-latest
      env:
        # üîê Secrets (private, safe for credentials & API keys)
        SPREADSHEET_ID: ${{ secrets.SPREADSHEET_ID }}
        SERVICE_ACC_KEY: ${{ secrets.SERVICE_ACC_KEY }}

      steps:
        - name: Checkout repo
          uses: actions/checkout@v4

        - name: Set up Python
          uses: actions/setup-python@v5
          with:
            python-version: "3.11"

        - name: Install dependencies
          run: |
            pip install -r requirements.txt || pip install requests python-dotenv pillow numpy

        - name: Run script
          run: |
            python src/unsoobscribe.py "${{ github.event.client_payload['Email Address'] }}"